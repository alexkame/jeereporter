<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.rpt.dao.ZinccoatingthicknessLogDao">
    
	<sql id="zinccoatingthicknessLogColumns">
		a.id AS "id",
		a.logtime AS "logtime",
		a.loggroup AS "loggroup",
		a.prodcode AS "prodcode",
		a.gencode AS "gencode",
		a.workmode AS "workmode",
		a.bandwidth AS "bandwidth",
		a.bandthickness AS "bandthickness",
		a.linespeed AS "linespeed",
		a.walklen AS "walklen",
		a.zincrateunilateral AS "zincrateunilateral",
		a.detectionpositionfront AS "detectionpositionfront",
		a.detectionpositionreverse AS "detectionpositionreverse",
		a.zincratefront AS "zincratefront",
		a.zincratereverse AS "zincratereverse"
	</sql>
	
	<sql id="zinccoatingworkteamReportColumns">
	    DATE_FORMAT(a.logtime, '%Y-%m-%d %h:%i:00') AS logtime,
	    a.loggroup AS 'loggroup',
	    (CASE
	        WHEN a.loggroup = 1 THEN '甲班'
	        WHEN a.loggroup = 2 THEN '乙班'
	        ELSE ''
	    END) AS loggroupname,
	    a.prodcode AS 'prodcode',
	    a.gencode AS 'gencode',
	    a.workmode AS 'workmode',
	    (CASE
	        WHEN a.workmode = 1 THEN '定点检测'
	        ELSE ''
	    END) AS workmodename,
	    AVG(a.bandwidth) AS 'bandwidth',
	    AVG(a.bandthickness) AS 'bandthickness',
	    AVG(a.linespeed) AS 'linespeed',
	    SUM(a.walklen) AS 'totallen',
	    SUM(a.bandwidth * a.bandthickness * a.walklen * 7.9 / 1000000) AS totalsteel,
	    0 AS zincratetarget,
	    0 AS zincrateavgfront,
	    0 AS zincrateavgreverse,
	    0 AS zinctotalinc,
	    0 AS zinctotalincfront,
	    0 AS zinctotalincreverse
	</sql>
	
	<sql id="zinccoatingthicknessLogJoins">
	</sql>
	
	<!-- 班报表 -->
	<select id="queryZinccoatingworkteamReport" resultType="ZinccoatingWorkTeamReport">
        SELECT 
			<include refid="zinccoatingworkteamReportColumns"/>
		FROM rpt_base_zinccoatingthickness_log a
        <where>
            <if test="beginLogtime != null and endLogtime != null and beginLogtime != '' and endLogtime != ''">
				AND a.logtime BETWEEN #{beginLogtime} AND #{endLogtime}
			</if>
			<if test="loggroup != null and loggroup != ''">
				AND a.loggroup = #{loggroup}
			</if>
        </where>
        GROUP BY DATE_FORMAT(a.logtime, '%Y-%m-%d %h:%i:00') , a.loggroup
        <choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			    ORDER BY a.logtime DESC
			</otherwise>
		</choose>
	</select>
    
	<select id="get" resultType="ZinccoatingthicknessLog">
		SELECT 
			<include refid="zinccoatingthicknessLogColumns"/>
		FROM rpt_base_zinccoatingthickness_log a
		<include refid="zinccoatingthicknessLogJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="ZinccoatingthicknessLog">
		SELECT 
			<include refid="zinccoatingthicknessLogColumns"/>
		FROM rpt_base_zinccoatingthickness_log a
		<include refid="zinccoatingthicknessLogJoins"/>
		<where>
			
			<if test="beginLogtime != null and endLogtime != null and beginLogtime != '' and endLogtime != ''">
				AND a.logtime BETWEEN #{beginLogtime} AND #{endLogtime}
			</if>
			<if test="loggroup != null and loggroup != ''">
				AND a.loggroup = #{loggroup}
			</if>
			<if test="prodcode != null and prodcode != ''">
				AND a.prodcode = #{prodcode}
			</if>
			<if test="gencode != null and gencode != ''">
				AND a.gencode = #{gencode}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			    ORDER BY id DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="ZinccoatingthicknessLog">
		SELECT 
			<include refid="zinccoatingthicknessLogColumns"/>
		FROM rpt_base_zinccoatingthickness_log a
		<include refid="zinccoatingthicknessLogJoins"/>
		<where>
			
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO rpt_base_zinccoatingthickness_log(
			id,
			logtime,
			loggroup,
			prodcode,
			gencode,
			workmode,
			bandwidth,
			bandthickness,
			linespeed,
			walklen,
			zincrateunilateral,
			detectionpositionfront,
			detectionpositionreverse,
			zincratefront,
			zincratereverse
		) VALUES (
			#{id},
			#{logtime},
			#{loggroup},
			#{prodcode},
			#{gencode},
			#{workmode},
			#{bandwidth},
			#{bandthickness},
			#{linespeed},
			#{walklen},
			#{zincrateunilateral},
			#{detectionpositionfront},
			#{detectionpositionreverse},
			#{zincratefront},
			#{zincratereverse}
		)
	</insert>
	
	<update id="update">
		UPDATE rpt_base_zinccoatingthickness_log SET 	
			logtime = #{logtime},
			loggroup = #{loggroup},
			prodcode = #{prodcode},
			gencode = #{gencode},
			workmode = #{workmode},
			bandwidth = #{bandwidth},
			bandthickness = #{bandthickness},
			linespeed = #{linespeed},
			walklen = #{walklen},
			zincrateunilateral = #{zincrateunilateral},
			detectionpositionfront = #{detectionpositionfront},
			detectionpositionreverse = #{detectionpositionreverse},
			zincratefront = #{zincratefront},
			zincratereverse = #{zincratereverse}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		DELETE FROM rpt_base_zinccoatingthickness_log
		WHERE id = #{id}
	</update>
	
</mapper>