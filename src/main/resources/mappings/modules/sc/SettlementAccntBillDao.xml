<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.sc.accntbill.dao.SettlementAccntBillDao">
    
	<sql id="settlementAccntBillColumns">
		a.id AS "id",
		a.accountyear AS "accountyear",
		a.accountmonth AS "accountmonth",
		a.accountweek AS "accountweek",
		a.accountid AS "accountid",
		a.accountstate AS "accountstate",
		a.accountrole AS "accountrole",
		a.balance AS "balance",
		FORMAT(a.balance, 2) AS "strBalance",
		a.scsum AS "scsum",
		FORMAT(a.scsum, 2) AS "strScsum",
		<!-- a.scsum AS "scsum", -->
		a.deposit AS "deposit",
		FORMAT(a.deposit, 2) AS "strDeposit",
		a.overdraft AS "overdraft",
		FORMAT(a.overdraft, 2) AS "strOverdraft",
		a.discount AS "discount", 
		FORMAT(a.discount, 2) AS "strDiscount",
		a.adjustvalue AS "adjustvalue",
		FORMAT(a.adjustvalue, 2) AS "strAdjustvalue",
		a.create_time AS "createTime",
		a.update_time AS "updateTime",
		a.hotelid AS "hotelid",
		a.hotelname AS "hotelname",
		a.hotelpms AS "hotelpms",
		a.begin_date AS "beginDate",
		a.end_date AS "endDate",
		a.sctype AS "sctype",
		a.paytype AS "paytype",
		a.billstate AS "billstate",
		a.biztype AS "biztype",
		a.scstate AS "scstate",
		a.beginbalance AS "beginbalance"
	</sql>
	
	<sql id="settlementAccntBillJoins">
	</sql>
    
	<select id="get" resultType="SettlementAccntBill">
		SELECT 
			<include refid="settlementAccntBillColumns"/>
		FROM settlement_accnt_bill a
		<include refid="settlementAccntBillJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="SettlementAccntBill">
		SELECT 
			<include refid="settlementAccntBillColumns"/>
			<!-- FORMAT(a.scsum, 2) AS strScsum -->
		FROM settlement_accnt_bill a
		<include refid="settlementAccntBillJoins"/>
		<where>
			<if test="roles != null">
			    AND a.accountrole in 
                <foreach item="item" index="index" collection="roles" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="beginAccountyear != null and endAccountyear != null and beginAccountyear != '' and endAccountyear != ''">
				AND a.accountyear BETWEEN #{beginAccountyear} AND #{endAccountyear}
			</if>
			<if test="beginAccountmonth != null and endAccountmonth != null and beginAccountmonth != '' and endAccountmonth != ''">
				AND a.accountmonth BETWEEN #{beginAccountmonth} AND #{endAccountmonth}
			</if>
			<if test="beginAccountweek != null and endAccountweek != null and beginAccountweek != '' and endAccountweek != ''">
				AND a.accountweek BETWEEN #{beginAccountweek} AND #{endAccountweek}
			</if>
			<if test="accountid != null and accountid != ''">
				AND a.accountid = #{accountid}
			</if>
			<if test="accountstate != null and accountstate != ''">
				AND a.accountstate = #{accountstate}
			</if>
			<if test="accountrole != null and accountrole != ''">
				AND a.accountrole = #{accountrole}
			</if>
			<if test="beginBalance != null and beginBalance != ''">
				AND a.balance <![CDATA[>=]]> #{beginBalance}
			</if>
			<if test="endBalance != null and endBalance != ''">
				AND a.balance <![CDATA[<]]> #{endBalance}
			</if>
			<if test="beginScsum != null and beginScsum != ''">
				AND a.scsum <![CDATA[>=]]> #{beginScsum}
			</if>
			<if test="endScsum != null and endScsum != ''">
				AND a.scsum <![CDATA[<]]> #{endScsum}
			</if>
			<if test="beginDeposit != null and endDeposit != null and beginDeposit != '' and endDeposit != ''">
				AND a.deposit BETWEEN #{beginDeposit} AND #{endDeposit}
			</if>
			<if test="beginOverdraft != null and endOverdraft != null and beginOverdraft != '' and endOverdraft != ''">
				AND a.overdraft BETWEEN #{beginOverdraft} AND #{endOverdraft}
			</if>
			<if test="beginDiscount != null and endDiscount != null and beginDiscount != '' and endDiscount != ''">
				AND a.discount BETWEEN #{beginDiscount} AND #{endDiscount}
			</if>
			<if test="beginAdjustvalue != null and endAdjustvalue != null and beginAdjustvalue != '' and endAdjustvalue != ''">
				AND a.adjustvalue BETWEEN #{beginAdjustvalue} AND #{endAdjustvalue}
			</if>
			<if test="beginCreateTime != null and endCreateTime != null and beginCreateTime != '' and endCreateTime != ''">
				AND a.create_time BETWEEN #{beginCreateTime} AND #{endCreateTime}
			</if>
			<if test="beginUpdateTime != null and endUpdateTime != null and beginUpdateTime != '' and endUpdateTime != ''">
				AND a.update_time BETWEEN #{beginUpdateTime} AND #{endUpdateTime}
			</if>
			<if test="hotelid != null and hotelid != ''">
				AND a.hotelid = #{hotelid}
			</if>
			<if test="hotelname != null and hotelname != ''">
				AND a.hotelname LIKE 
					<if test="dbName == 'oracle'">'%'||#{hotelname}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{hotelname}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{hotelname},'%')</if>
			</if>
			<if test="hotelpms != null and hotelpms != ''">
				AND a.hotelpms = #{hotelpms}
			</if>
            <if test="beginBeginDate != null and beginBeginDate != ''">
                AND a.begin_date <![CDATA[>=]]> #{beginBeginDate}
            </if>
            <if test="endBeginDate != null and endBeginDate != ''">
                AND a.begin_date <![CDATA[<]]> #{endBeginDate}
            </if>
            <if test="beginEndDate != null and beginEndDate != ''">
                AND a.end_date <![CDATA[>=]]> #{beginEndDate}
            </if>
            <if test="endEndDate != null and endEndDate != ''">
                AND a.end_date <![CDATA[<]]> #{endEndDate}
            </if>
			<if test="beginDate != null">
				AND a.begin_date = #{beginDate}
			</if>
			<if test="endDate != null">
				AND a.end_date = #{endDate}
			</if>
			<if test="sctype != null and sctype != ''">
				AND a.sctype = #{sctype}
			</if>
			<if test="paytype != null and paytype != ''">
				AND a.paytype = #{paytype}
			</if>
			<if test="billstate != null and billstate != ''">
				AND a.billstate = #{billstate}
			</if>
			<if test="biztype != null and biztype != ''">
				AND a.biztype = #{biztype}
			</if>
			<if test="scstate != null and scstate != ''">
				AND a.scstate = #{scstate}
			</if>
			<if test="beginBeginbalance != null and endBeginbalance != null and beginBeginbalance != '' and endBeginbalance != ''">
				AND a.beginbalance BETWEEN #{beginBeginbalance} AND #{endBeginbalance}
			</if>
			<if test="accountyear != null and accountyear != '' and accountyear != 0">
				AND a.accountyear = #{accountyear}
			</if>
			<if test="accountmonth != null and accountmonth != '' and accountmonth != 0">
				AND a.accountmonth = #{accountmonth}
			</if>
		</where>
        <choose>
            <when test="page !=null and page.orderBy != null and page.orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
            </otherwise>
        </choose>
	</select>
	
	<select id="findAllList" resultType="SettlementAccntBill">
		SELECT 
			<include refid="settlementAccntBillColumns"/>
		FROM settlement_accnt_bill a
		<include refid="settlementAccntBillJoins"/>
		<where>
			
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>

	<insert id="insert">
		INSERT INTO settlement_accnt_bill(
			id,
			accountyear,
			accountmonth,
			accountweek,
			accountid,
			accountstate,
			accountrole,
			balance,
			scsum,
			deposit,
			overdraft,
			discount,
			adjustvalue,
			create_time,
			update_time,
			hotelid,
			hotelname,
			hotelpms,
			begin_date,
			end_date,
			sctype,
			paytype,
			billstate,
			biztype,
			scstate,
			beginbalance
		) VALUES (
			#{id},
			#{accountyear},
			#{accountmonth},
			#{accountweek},
			#{accountid},
			#{accountstate},
			#{accountrole},
			#{balance},
			#{scsum},
			#{deposit},
			#{overdraft},
			#{discount},
			#{adjustvalue},
			#{createTime},
			#{updateTime},
			#{hotelid},
			#{hotelname},
			#{hotelpms},
			#{beginDate},
			#{endDate},
			#{sctype},
			#{paytype},
			#{billstate},
			#{biztype},
			#{scstate},
			#{beginbalance}
		)
	</insert>
	
	<update id="update">
		UPDATE settlement_accnt_bill SET 	
			accountyear = #{accountyear},
			accountmonth = #{accountmonth},
			accountweek = #{accountweek},
			accountid = #{accountid},
			accountstate = #{accountstate},
			accountrole = #{accountrole},
			balance = #{balance},
			scsum = #{scsum},
			deposit = #{deposit},
			overdraft = #{overdraft},
			discount = #{discount},
			adjustvalue = #{adjustvalue},
			create_time = #{createTime},
			update_time = #{updateTime},
			hotelid = #{hotelid},
			hotelname = #{hotelname},
			hotelpms = #{hotelpms},
			begin_date = #{beginDate},
			end_date = #{endDate},
			sctype = #{sctype},
			paytype = #{paytype},
			billstate = #{billstate},
			biztype = #{biztype},
			scstate = #{scstate},
			beginbalance = #{beginbalance}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		DELETE FROM settlement_accnt_bill
		WHERE id = #{id}
	</update>
	
</mapper>