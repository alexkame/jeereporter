<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.psb.psbrulesrelation.dao.SettlementPsbrulesrelationDao">
    
	<sql id="settlementPsbrulesrelationColumns">
		a.id AS "id",
		a.psbid AS "psbid",
		a.procode AS "procode",
		a.proname AS "proname",
		a.citycode AS "citycode",
		a.cityname AS "cityname",
		a.discode AS "discode",
		a.disname AS "disname",
		a.hotelid AS "hotelid",
		a.hotelpms AS "hotelpms",
		a.hotelname AS "hotelname",
		a.cityrules AS "cityrules",
		a.hotelrules AS "hotelrules",
		a.begintime AS "begintime",
		a.endtime AS "endtime",
		a.createtime AS "createtime",
		a.updatetime AS "updatetime",
		a.areatype AS "areatype",
		a.disrules AS "disrules",
		a.delflag AS "delflag"
	</sql>
	
	<sql id="settlementPsbrulesrelationJoins">
	</sql>
    
	<select id="get" resultType="SettlementPsbrulesrelation">
		SELECT 
			<include refid="settlementPsbrulesrelationColumns"/>
		FROM settlement_psbrulesrelation a
		<include refid="settlementPsbrulesrelationJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="SettlementPsbrulesrelation">
		SELECT 
			<include refid="settlementPsbrulesrelationColumns"/>
			, b.psbname AS psbname
		FROM settlement_psbrulesrelation a 
			LEFT JOIN settlement_psbinfo b ON a.psbid = b.id
		<include refid="settlementPsbrulesrelationJoins"/>
		<where>
			
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="psbid != null and psbid != ''">
				AND a.psbid = #{psbid}
			</if>
			<if test="procode != null and procode != ''">
				AND a.procode = #{procode}
			</if>
			<if test="proname != null and proname != ''">
				AND a.proname = #{proname}
			</if>
			<if test="citycode != null and citycode != ''">
				AND a.citycode = #{citycode}
			</if>
			<if test="cityname != null and cityname != ''">
				AND a.cityname = #{cityname}
			</if>
			<if test="discode != null and discode != ''">
				AND a.discode = #{discode}
			</if>
			<if test="disname != null and disname != ''">
				AND a.disname = #{disname}
			</if>
			<if test="hotelid != null and hotelid != ''">
				AND a.hotelid = #{hotelid}
			</if>
			<if test="hotelpms != null and hotelpms != ''">
				AND a.hotelpms = #{hotelpms}
			</if>
			<if test="hotelname != null and hotelname != ''">
				AND a.hotelname LIKE 
					<if test="dbName == 'oracle'">'%'||#{hotelname}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{hotelname}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{hotelname},'%')</if>
			</if>
			<if test="cityrules != null and cityrules != ''">
				AND a.cityrules = #{cityrules}
			</if>
			<if test="hotelrules != null and hotelrules != ''">
				AND a.hotelrules = #{hotelrules}
			</if>
			<if test="disrules != null and disrules != ''">
				AND a.disrules = #{disrules}
			</if>
			<if test="beginBegintime != null and beginBegintime != ''">
				AND a.begintime <![CDATA[>=]]> #{beginBegintime}
			</if>
			<if test="endBegintime != null and endBegintime != ''">
				AND a.begintime <![CDATA[<=]]> #{endBegintime}
			</if>
			<if test="beginEndtime != null and beginEndtime != ''">
				AND a.endtime <![CDATA[>=]]> #{beginEndtime}
			</if>
			<if test="endEndtime != null and endEndtime != ''">
				AND a.endtime <![CDATA[<=]]> #{endEndtime}
			</if>
			<if test="beginCreatetime != null and beginCreatetime != ''">
				AND a.createtime <![CDATA[>=]]> #{beginCreatetime}
			</if>
			<if test="endCreatetime != null and endCreatetime != ''">
				AND a.createtime <![CDATA[<=]]> #{endCreatetime}
			</if>
			<if test="beginUpdatetime != null and beginUpdatetime != ''">
				AND a.updatetime <![CDATA[>=]]> #{beginUpdatetime}
			</if>
			<if test="areatype != null and areatype != ''">
				AND a.areatype= #{areatype}
			</if>
			<if test="delflag != null and delflag != ''">
				AND a.delflag = #{delflag}
			</if>
			<if test="delflag == null or delflag == ''">
				AND a.delflag = 1
			</if>
		</where>
		ORDER BY id
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				, ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
		DESC
	</select>
	
	<select id="findAllList" resultType="SettlementPsbrulesrelation">
		SELECT 
			<include refid="settlementPsbrulesrelationColumns"/>
		FROM settlement_psbrulesrelation a
		<include refid="settlementPsbrulesrelationJoins"/>
		<where>
			
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<!-- 根据省 区 查询规则 -->
	<select id="getRulesByhotelid" resultType="java.util.HashMap">
		SELECT 
			a.id AS "id",
			a.psbid AS "psbid",
			a.procode AS "procode",
			a.proname AS "proname",
			a.citycode AS "citycode",
			a.cityname AS "cityname",
			a.discode AS "discode",
			a.disname AS "disname",
			a.hotelid AS "hotelid",
			a.hotelpms AS "hotelpms",
			a.hotelname AS "hotelname",
			a.cityrules AS "cityrules",
			a.hotelrules AS "hotelrules",
			a.begintime AS "begintime",
			a.endtime AS "endtime",
			a.createtime AS "createtime",
			a.updatetime AS "updatetime",
			a.areatype AS "areatype",
			psb.psbname,
			a.delflag AS "delflag"
		FROM settlement_psbrulesrelation a LEFT JOIN settlement_psbinfo psb ON a.psbid = psb.id
		
		<where>
			a.procode = #{procode}
			AND a.citycode = #{citycode}
			AND a.hotelid IS NULL LIMIT 1
		</where>		
	</select>
	
	<!-- 查询酒店规则是否已经存在 -->
	<select id="getByHotelid" resultType="SettlementPsbrulesrelation">
		SELECT 
			<include refid="settlementPsbrulesrelationColumns"/>
		FROM settlement_psbrulesrelation a
		<include refid="settlementPsbrulesrelationJoins"/>
		<where>
			a.hotelid = #{hotelid}
			AND a.areatype = 3 LIMIT 1
		</where>		
	</select>
	
	<!-- 查询区域规则是否已经存在 -->
	<select id="getByDiscode" resultType="SettlementPsbrulesrelation">
		SELECT 
			<include refid="settlementPsbrulesrelationColumns"/>
		FROM settlement_psbrulesrelation a
		<include refid="settlementPsbrulesrelationJoins"/>
		<where>
			a.procode = #{procode}
			AND a.citycode = #{citycode}
			AND a.discode = #{discode}
			AND a.areatype = 2 LIMIT 1
		</where>		
	</select>
	
	<!-- 查询城市规则是否已经存在 -->
	<select id="getByCitycode" resultType="SettlementPsbrulesrelation">
		SELECT 
			<include refid="settlementPsbrulesrelationColumns"/>
		FROM settlement_psbrulesrelation a
		<include refid="settlementPsbrulesrelationJoins"/>
		<where>
			a.procode = #{procode}
			AND a.citycode = #{citycode}
			AND a.areatype = 1
			AND a.delflag = 1 LIMIT 1
		</where>		
	</select>
	
	<insert id="insert">
		INSERT INTO settlement_psbrulesrelation(
			psbid,
			procode,
			proname,
			citycode,
			cityname,
			discode,
			disname,
			hotelid,
			hotelpms,
			hotelname,
			cityrules,
			hotelrules,
			begintime,
			endtime,
			createtime,
			updatetime,
			areatype,
			disrules,
			delflag
		) VALUES (
			#{psbid},
			#{procode},
			#{proname},
			#{citycode},
			#{cityname},
			#{discode},
			#{disname},
			#{hotelid},
			#{hotelpms},
			#{hotelname},
			#{cityrules},
			#{hotelrules},
			#{begintime},
			#{endtime},
			#{createtime},
			#{updatetime},
			#{areatype},
			#{disrules},
			#{delflag}
		)
	</insert>
	
	<update id="update">
		UPDATE settlement_psbrulesrelation SET 	
			psbid = #{psbid},
			procode = #{procode},
			proname = #{proname},
			citycode = #{citycode},
			cityname = #{cityname},
			discode = #{discode},
			disname = #{disname},
			hotelid = #{hotelid},
			hotelpms = #{hotelpms},
			hotelname = #{hotelname},
			cityrules = #{cityrules},
			hotelrules = #{hotelrules},
			begintime = #{begintime},
			endtime = #{endtime},
			createtime = #{createtime},
			updatetime = #{updatetime},
			areatype = #{areatype},
			disrules = #{disrules},
			delflag = #{delflag}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		DELETE FROM settlement_psbrulesrelation
		WHERE id = #{id}
	</update>
	
	<update id="deleteids">
		UPDATE settlement_psbrulesrelation SET 	
			delflag = 1
		WHERE id IN
			<foreach collection="ids" item="item" index="index" open="(" separator="," close=")">
				#{item}
		  	</foreach>
	</update>
	
</mapper>