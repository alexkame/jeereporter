<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.oms.dao.OmsOrderItemDao">
    
	<sql id="omsOrderItemColumns">
		a.id AS "selfId",
		a.s_atime AS "sAtime",
		a.s_mtime AS "sMtime",
		a.s_cmpy AS "sCmpy",
		a.orderid AS "orderid",
		a.skuid AS "skuid",
		a.num AS "num",
		a.title AS "title",
		a.totole_fee AS "totoleFee",
		a.discount AS "discount",
		a.payment AS "payment",
		a.invoice_time AS "invoiceTime",
		a.remarks AS "remarks",
		a.weight AS "weight",
		a.yundan_begin as "yundanBegin",
		a.yundan_end as "yundanEnd",
		a.yundan_wuliu as "yundanWuliu",
		a.wuliu_cmpy as "wuliuCmpy"
	</sql>
	
	<sql id="omsOrderItemJoins">
		LEFT JOIN oms_order b ON b.id = a.orderid
	</sql>
    
	<select id="get" resultType="OmsOrderItem">
		SELECT 
			<include refid="omsOrderItemColumns"/>
		FROM oms_order_item a
		<include refid="omsOrderItemJoins"/>
		WHERE a.id = #{selfId}
	</select>
	
	<select id="findList" resultType="OmsOrderItem">
		SELECT 
			<include refid="omsOrderItemColumns"/>
		FROM oms_order_item a
		<include refid="omsOrderItemJoins"/>
		<where>
			
			<if test="orderid != null and orderid != ''">
				AND a.orderid = #{orderid.orderId}
			</if>
			<if test="title != null and title != ''">
				AND a.title LIKE 
					<if test="dbName == 'oracle'">'%'||#{title}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{title}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{title},'%')</if>
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="OmsOrderItem">
		SELECT 
			<include refid="omsOrderItemColumns"/>
		FROM oms_order_item a
		<include refid="omsOrderItemJoins"/>
		<where>
			
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO oms_order_item(
			id,
			s_atime,
			s_mtime,
			s_cmpy,
			orderid,
			skuid,
			num,
			title,
			totole_fee,
			discount,
			payment
		) VALUES (
			#{id},
			#{sAtime},
			#{sMtime},
			#{sCmpy},
			#{orderid},
			#{skuid},
			#{num},
			#{title},
			#{totoleFee},
			#{discount},
			#{payment}
		)
	</insert>
	
	<update id="update">
		UPDATE oms_order_item SET 	
			s_atime = #{sAtime},
			s_mtime = #{sMtime},
			s_cmpy = #{sCmpy},
			orderid = #{orderid},
			skuid = #{skuid},
			num = #{num},
			title = #{title},
			totole_fee = #{totoleFee},
			discount = #{discount},
			payment = #{payment}
		WHERE id = #{selfId}
	</update>
	
	<update id="delete">
		DELETE FROM oms_order_item
		<choose>
			<when test="id !=null and id != ''">
				WHERE id = #{selfId}
			</when>
			<otherwise>
				WHERE orderid = #{orderid}
			</otherwise>
		</choose>
	</update>
	
	<!-- 修改发货时间 -->
	<update id="updateInvoiceTime">
	update oms_order_item 
	set invoice_time=#{invoiceTime},
	remarks=#{remarks}
	where id=#{selfId}
	
	
	
	</update>
	
	
	<select id="findMaxYundan" resultType="Integer">
		SELECT MAX(yundan_end)
		FROM oms_order_item
	</select>
	
	<update id="updateYundan">
		update oms_order_item 
		set yundan_begin = #{yundanBegin},
		    yundan_end = #{yundanEnd}
		where id = #{itemId}
	</update>		
	
	
</mapper>