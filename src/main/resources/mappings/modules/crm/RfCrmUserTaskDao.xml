<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.crm.task.dao.RfCrmUserTaskDao">
    
	<sql id="rfCrmUserTaskColumns">
		a.id AS "id",
		a.sender_user_id AS "senderUserId",
		a.sender_user_name AS "senderUserName",
		a.name AS "name",
		a.is_complete AS "isComplete",
		a.priority AS "priority",
		a.remark AS "remark",
		a.create_time AS "createTime",
		a.update_time AS "updateTime",
		a.end_time AS "endTime",
		a.complete_time AS "completeTime"
	</sql>
	
	<sql id="rfCrmUserTaskJoins">
	</sql>
    
	<select id="get" resultType="RfCrmUserTask">
		SELECT 
			<include refid="rfCrmUserTaskColumns"/>
		FROM rf_crm_user_task a
		<include refid="rfCrmUserTaskJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="RfCrmUserTask">
		SELECT 
			<include refid="rfCrmUserTaskColumns"/>
		FROM rf_crm_user_task a
		<include refid="rfCrmUserTaskJoins"/>
		<where>
			
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="senderUserId != null and senderUserId != ''">
				AND a.sender_user_id = #{senderUserId}
			</if>
			<if test="senderUserName != null and senderUserName != ''">
				AND a.sender_user_name like CONCAT('%', #{senderUserName}, '%')
			</if>
			<if test="name != null and name != ''">
				AND a.name LIKE 
					<if test="dbName == 'oracle'">'%'||#{name}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{name}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{name},'%')</if>
			</if>
			<if test="isComplete != null and isComplete != ''">
				AND a.is_complete = #{isComplete}
			</if>
			<if test="priority != null and priority != ''">
				AND a.priority = #{priority}
			</if>
			<if test="remark != null and remark != ''">
				AND a.remark = #{remark}
			</if>
			<if test="createTime != null and createTime != ''">
				AND a.create_time = #{createTime}
			</if>
			<if test="updateTime != null and updateTime != ''">
				AND a.update_time = #{updateTime}
			</if>
			<if test="endTime != null and endTime != ''">
				AND a.end_time = #{endTime}
			</if>
			<if test="completeTime != null and completeTime != ''">
				AND a.complete_time = #{completeTime}
			</if>
			
			<if test="startCreateTime != null and startCreateTime != ''">
				<![CDATA[AND a.create_time >= #{startCreateTime}]]>
			</if>
			<if test="endCreateTime != null and endCreateTime != ''">
				<![CDATA[AND a.create_time <= #{endCreateTime} ]]>    
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="RfCrmUserTask">
		SELECT 
			<include refid="rfCrmUserTaskColumns"/>
		FROM rf_crm_user_task a
		<include refid="rfCrmUserTaskJoins"/>
		<where>
			
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.String">
	      SELECT LAST_INSERT_ID()
	    </selectKey>
		INSERT INTO rf_crm_user_task(
			sender_user_id,
			sender_user_name,
			name,
			is_complete,
			priority,
			remark,
			create_time,
			update_time,
			end_time,
			complete_time
		) VALUES (
			#{senderUserId},
			#{senderUserName},
			#{name},
			#{isComplete},
			#{priority},
			#{remark},
			#{createTime},
			#{updateTime},
			#{endTime},
			#{completeTime}
		)
	</insert>
	
	<update id="update">
		UPDATE rf_crm_user_task SET 	
			sender_user_id = #{senderUserId},
			sender_user_name = #{senderUserName},
			name = #{name},
			is_complete = #{isComplete},
			priority = #{priority},
			remark = #{remark},
			create_time = #{createTime},
			update_time = #{updateTime},
			end_time = #{endTime},
			complete_time = #{completeTime}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		DELETE FROM rf_crm_user_task
		WHERE id = #{id}
	</update>
	
</mapper>